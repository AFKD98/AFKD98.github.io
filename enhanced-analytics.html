<!DOCTYPE html>
<html lang="en">
  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <!-- Metadata, OpenGraph and Schema.org -->




<!-- Standard metadata -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>
  
  
    Enhanced Analytics Dashboard | Ahmad Faraz Khan
  
</title>
<meta name="author" content="Ahmad Faraz Khan">
<meta name="description" content="Enhanced Website Analytics Dashboard - Comprehensive visitor tracking and insights">

  <meta name="keywords" content="Analytics, Website Tracking, Visitor Statistics, Enhanced Tracking">

<!-- Bootstrap & MDB -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

<!-- Fonts & Icons -->
<link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5">
<link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CRoboto+Slab:100,300,400,500,700%7CMaterial+Icons&amp;display=swap">

<!-- Styles -->
<link rel="shortcut icon" href="/assets/img/website_icon.png?976034b2530bc12e943f52090f184b35">
<link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e">
<link rel="canonical" href="https://afkd98.github.io/enhanced-analytics.html">

<!-- Dark Mode -->
<link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark">
<script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script>

<!-- Google Analytics 4 -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script>

<!-- Custom Analytics Tracking -->
<script src="/assets/js/analytics.js"></script>

<!-- Chart.js for Analytics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
.analytics-card {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.analytics-card h3 {
  color: white;
  margin-bottom: 10px;
}

.stat-number {
  font-size: 2.5rem;
  font-weight: bold;
  margin-bottom: 5px;
}

.stat-label {
  font-size: 0.9rem;
  opacity: 0.9;
}

.chart-container {
  background: white;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.analytics-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 40px 0;
  margin-bottom: 30px;
}

.analytics-header h1 {
  color: white;
  margin-bottom: 10px;
}

.analytics-header p {
  color: rgba(255,255,255,0.9);
  font-size: 1.1rem;
}

.visitor-table {
  background: white;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.visitor-table table {
  width: 100%;
  border-collapse: collapse;
}

.visitor-table th,
.visitor-table td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #eee;
}

.visitor-table th {
  background-color: #f8f9fa;
  font-weight: bold;
}

.server-status {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 10px 15px;
  border-radius: 5px;
  color: white;
  font-weight: bold;
  z-index: 1000;
}

.server-status.connected {
  background-color: #28a745;
}

.server-status.disconnected {
  background-color: #dc3545;
}

.real-time-indicator {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}
</style>

  </head>

  <!-- Body -->
  <body class="fixed-top-nav">
    <!-- Server Status Indicator -->
    <div id="serverStatus" class="server-status disconnected">
      Server: Disconnected
    </div>

    <!-- Header -->
    <header>
      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation">
        <div class="container">
          
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">
              
              <!-- About -->
              <li class="nav-item">
                <a class="nav-link" href="/">Home</a>
              </li>

              <!-- Other pages -->
              <li class="nav-item">
                <a class="nav-link" href="/publications/">Publications</a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="/projects/">Projects</a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="/cv/">CV</a>
              </li>

              <li class="nav-item">
                <a class="nav-link" href="/blog/">Blog</a>
              </li>

            </ul>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <div class="container mt-5">
      <!-- Analytics Header -->
      <div class="analytics-header text-center">
        <h1>Enhanced Analytics Dashboard</h1>
        <p>Comprehensive visitor tracking and detailed insights</p>
      </div>

      <!-- Quick Stats -->
      <div class="row">
        <div class="col-md-3">
          <div class="analytics-card text-center">
            <div class="stat-number" id="unique-visitors">--</div>
            <div class="stat-label">Unique Visitors</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="analytics-card text-center">
            <div class="stat-number" id="total-sessions">--</div>
            <div class="stat-label">Total Sessions</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="analytics-card text-center">
            <div class="stat-number" id="recent-sessions">--</div>
            <div class="stat-label">Recent Sessions (24h)</div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="analytics-card text-center">
            <div class="stat-number real-time-indicator" id="real-time-visitors">--</div>
            <div class="stat-label">Real-time Visitors</div>
          </div>
        </div>
      </div>

      <!-- Charts -->
      <div class="row">
        <div class="col-md-6">
          <div class="chart-container">
            <h4>Top Pages (Last 24 Hours)</h4>
            <canvas id="pagesChart"></canvas>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-container">
            <h4>Traffic Sources</h4>
            <canvas id="sourcesChart"></canvas>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="chart-container">
            <h4>Device Types</h4>
            <canvas id="devicesChart"></canvas>
          </div>
        </div>
        <div class="col-md-6">
          <div class="chart-container">
            <h4>Recent Events</h4>
            <canvas id="eventsChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Recent Visitors Table -->
      <div class="visitor-table">
        <h4>Recent Visitors</h4>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Time</th>
                <th>IP Address</th>
                <th>Device</th>
                <th>Location</th>
                <th>User Agent</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="visitorsTable">
              <tr>
                <td colspan="6" class="text-center">Loading visitor data...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Search Visitors -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5>Search Visitors</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <input type="text" id="searchIP" class="form-control" placeholder="Search by IP address">
                </div>
                <div class="col-md-4">
                  <input type="text" id="searchSession" class="form-control" placeholder="Search by Session ID">
                </div>
                <div class="col-md-4">
                  <button class="btn btn-primary" onclick="searchVisitors()">Search</button>
                  <button class="btn btn-secondary" onclick="exportData()">Export Data</button>
                </div>
              </div>
              <div id="searchResults" class="mt-3"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Setup Instructions -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5>Enhanced Analytics Setup</h5>
            </div>
            <div class="card-body">
              <ol>
                <li><strong>Install Dependencies:</strong> Run <code>npm install</code> in the website directory</li>
                <li><strong>Start Analytics Server:</strong> Run <code>npm start</code> to start the tracking server</li>
                <li><strong>Update Google Analytics:</strong> Replace "G-XXXXXXXXXX" with your actual Measurement ID</li>
                <li><strong>Deploy Website:</strong> Upload all files to your web server</li>
                <li><strong>Monitor Data:</strong> View real-time data at <code>http://localhost:3001/api/analytics/dashboard</code></li>
              </ol>
              <div class="alert alert-info">
                <strong>Enhanced Features:</strong> This system tracks IP addresses, device fingerprints, mouse movements, keyboard events, geolocation, and more detailed visitor information.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/theme.js"></script>

    <script>
      // Analytics Dashboard Controller
      class AnalyticsDashboard {
        constructor() {
          this.serverUrl = 'http://localhost:3001';
          this.charts = {};
          this.updateInterval = null;
          this.init();
        }

        async init() {
          await this.checkServerStatus();
          await this.loadDashboardData();
          this.startAutoRefresh();
        }

        async checkServerStatus() {
          try {
            const response = await fetch(`${this.serverUrl}/api/analytics/health`);
            const data = await response.json();
            
            const statusElement = document.getElementById('serverStatus');
            if (response.ok) {
              statusElement.textContent = `Server: Connected (${data.stats.visitors} visitors)`;
              statusElement.className = 'server-status connected';
            } else {
              throw new Error('Server not responding');
            }
          } catch (error) {
            const statusElement = document.getElementById('serverStatus');
            statusElement.textContent = 'Server: Disconnected';
            statusElement.className = 'server-status disconnected';
            console.log('Analytics server not running. Start it with: npm start');
          }
        }

        async loadDashboardData() {
          try {
            const response = await fetch(`${this.serverUrl}/api/analytics/dashboard`);
            const data = await response.json();
            
            this.updateStats(data.summary);
            this.updateCharts(data);
            this.updateVisitorsTable(data.recentSessions);
            
          } catch (error) {
            console.log('Could not load dashboard data:', error);
            this.showSampleData();
          }
        }

        updateStats(summary) {
          document.getElementById('unique-visitors').textContent = summary.uniqueVisitors || 0;
          document.getElementById('total-sessions').textContent = summary.totalSessions || 0;
          document.getElementById('recent-sessions').textContent = summary.recentSessions || 0;
          document.getElementById('real-time-visitors').textContent = summary.realTimeVisitors || 0;
        }

        updateCharts(data) {
          this.updatePagesChart(data.topPages);
          this.updateSourcesChart(data.topSources);
          this.updateDevicesChart(data.deviceBreakdown);
          this.updateEventsChart(data.recentEvents);
        }

        updatePagesChart(topPages) {
          const ctx = document.getElementById('pagesChart').getContext('2d');
          
          if (this.charts.pages) {
            this.charts.pages.destroy();
          }
          
          this.charts.pages = new Chart(ctx, {
            type: 'doughnut',
            data: {
              labels: topPages.map(p => p.page),
              datasets: [{
                data: topPages.map(p => p.count),
                backgroundColor: [
                  '#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe',
                  '#43e97b', '#38f9d7', '#fa709a', '#fee140', '#a8edea'
                ]
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'bottom'
                }
              }
            }
          });
        }

        updateSourcesChart(topSources) {
          const ctx = document.getElementById('sourcesChart').getContext('2d');
          
          if (this.charts.sources) {
            this.charts.sources.destroy();
          }
          
          this.charts.sources = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: topSources.map(s => s.source),
              datasets: [{
                data: topSources.map(s => s.count),
                backgroundColor: [
                  '#667eea', '#764ba2', '#f093fb', '#f5576c'
                ]
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  position: 'bottom'
                }
              }
            }
          });
        }

        updateDevicesChart(deviceBreakdown) {
          const ctx = document.getElementById('devicesChart').getContext('2d');
          
          if (this.charts.devices) {
            this.charts.devices.destroy();
          }
          
          this.charts.devices = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: deviceBreakdown.map(d => d.device),
              datasets: [{
                label: 'Visitors',
                data: deviceBreakdown.map(d => d.count),
                backgroundColor: [
                  '#667eea', '#764ba2', '#f093fb'
                ]
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }

        updateEventsChart(recentEvents) {
          const ctx = document.getElementById('eventsChart').getContext('2d');
          
          if (this.charts.events) {
            this.charts.events.destroy();
          }
          
          // Group events by type
          const eventTypes = recentEvents.reduce((acc, event) => {
            const type = event.event_category || 'other';
            acc[type] = (acc[type] || 0) + 1;
            return acc;
          }, {});
          
          this.charts.events = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: Object.keys(eventTypes),
              datasets: [{
                label: 'Events',
                data: Object.values(eventTypes),
                backgroundColor: '#667eea'
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }

        updateVisitorsTable(sessions) {
          const tbody = document.getElementById('visitorsTable');
          
          if (!sessions || sessions.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" class="text-center">No recent visitors</td></tr>';
            return;
          }
          
          tbody.innerHTML = sessions.map(session => {
            const time = new Date(session.timestamp).toLocaleString();
            const ip = session.ip || 'Unknown';
            const device = this.getDeviceType(session.deviceInfo?.userAgent || '');
            const location = this.getLocationInfo(session);
            const userAgent = session.deviceInfo?.userAgent?.substring(0, 50) + '...' || 'Unknown';
            
            return `
              <tr>
                <td>${time}</td>
                <td>${ip}</td>
                <td>${device}</td>
                <td>${location}</td>
                <td title="${session.deviceInfo?.userAgent || ''}">${userAgent}</td>
                <td>
                  <button class="btn btn-sm btn-outline-primary" onclick="viewSessionDetails('${session.sessionId}')">
                    Details
                  </button>
                </td>
              </tr>
            `;
          }).join('');
        }

        getDeviceType(userAgent) {
          if (/mobile/i.test(userAgent)) return 'Mobile';
          if (/tablet/i.test(userAgent)) return 'Tablet';
          return 'Desktop';
        }

        getLocationInfo(session) {
          if (session.locationInfo?.referrer) {
            try {
              const url = new URL(session.locationInfo.referrer);
              return url.hostname;
            } catch (e) {
              return 'Direct';
            }
          }
          return 'Direct';
        }

        startAutoRefresh() {
          this.updateInterval = setInterval(() => {
            this.loadDashboardData();
          }, 30000); // Refresh every 30 seconds
        }

        showSampleData() {
          // Show sample data when server is not available
          document.getElementById('unique-visitors').textContent = '0';
          document.getElementById('total-sessions').textContent = '0';
          document.getElementById('recent-sessions').textContent = '0';
          document.getElementById('real-time-visitors').textContent = '0';
        }
      }

      // Initialize dashboard
      const dashboard = new AnalyticsDashboard();

      // Global functions for search and export
      async function searchVisitors() {
        const ip = document.getElementById('searchIP').value;
        const sessionId = document.getElementById('searchSession').value;
        const resultsDiv = document.getElementById('searchResults');
        
        if (!ip && !sessionId) {
          resultsDiv.innerHTML = '<div class="alert alert-warning">Please enter an IP address or Session ID</div>';
          return;
        }
        
        try {
          const params = new URLSearchParams();
          if (ip) params.append('ip', ip);
          if (sessionId) params.append('sessionId', sessionId);
          
          const response = await fetch(`http://localhost:3001/api/analytics/search?${params}`);
          const data = await response.json();
          
          if (data.results.length === 0) {
            resultsDiv.innerHTML = '<div class="alert alert-info">No visitors found</div>';
            return;
          }
          
          const resultsHtml = data.results.map(result => `
            <div class="card mb-2">
              <div class="card-body">
                <h6>Session: ${result.sessionId}</h6>
                <p><strong>IP:</strong> ${result.ip}</p>
                <p><strong>Time:</strong> ${new Date(result.timestamp).toLocaleString()}</p>
                <p><strong>User Agent:</strong> ${result.userAgent}</p>
              </div>
            </div>
          `).join('');
          
          resultsDiv.innerHTML = resultsHtml;
          
        } catch (error) {
          resultsDiv.innerHTML = '<div class="alert alert-danger">Error searching visitors</div>';
        }
      }

      async function exportData() {
        try {
          const response = await fetch('http://localhost:3001/api/analytics/export');
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'analytics-export.json';
          a.click();
          window.URL.revokeObjectURL(url);
        } catch (error) {
          alert('Error exporting data. Make sure the analytics server is running.');
        }
      }

      function viewSessionDetails(sessionId) {
        alert(`Session details for: ${sessionId}\n\nThis would show detailed session information including all clicks, scrolls, and interactions.`);
      }
    </script>
  </body>
</html> 